build:
  runs-on: ubuntu-latest
  strategy:
    matrix:
      service:
        - name: coordinador
          path: blockchain/coordinador
          image: blockchain-coordinator
        - name: cpu-scaler
          path: blockchain/cpu-scaler
          image: blockchain-cpu-scaler
        - name: pool-manager
          path: blockchain/pool_manager
          image: blockchain-pool-manager

  steps:
    - uses: actions/checkout@v4

    - uses: docker/login-action@v3
      with:
        registry: ghcr.io
        username: ${{ github.actor }}
        password: ${{ secrets.GHCR_TOKEN }}

    # ðŸ”¹ Servicios Kubernetes
    - name: Build & Push ${{ matrix.service.name }}
      uses: docker/build-push-action@v5
      with:
        context: ${{ matrix.service.path }}
        push: true
        tags: ghcr.io/${{ github.repository_owner }}/${{ matrix.service.image }}:sha-${{ github.sha }}

    # ðŸ”¹ Worker CPU (fuera de K8s)
    - name: Build & Push worker-cpu (VM only)
      uses: docker/build-push-action@v5
      with:
        context: blockchain/minero/cpu
        push: true
        tags: ghcr.io/${{ github.repository_owner }}/worker-cpu:sha-${{ github.sha }}
